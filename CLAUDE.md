# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

sqlstitch is a Rust CLI tool that reads SQL files, analyzes foreign key constraints and table dependencies, and outputs statements in topologically sorted order for correct execution. It currently supports `CREATE TABLE` (with foreign key extraction) and `CREATE INDEX` statements.

## Build & Development Commands

```bash
cargo build                    # Debug build
cargo build --release          # Release build
cargo test                     # Run all tests
cargo test <test_name>         # Run a single test by name
cargo fmt                      # Format code
cargo fmt --check              # Check formatting
cargo clippy -- -D warnings    # Lint with warnings as errors
cargo run -- schema/*.sql      # Run on SQL files (outputs to stdout)
```

Rust toolchain version is pinned in `rust-toolchain.toml` (currently 1.89.0) and auto-resolved by cargo.

## Architecture

The codebase has 4 source files with a straightforward pipeline:

1. **`commands.rs`** — CLI definition using clap derive macros. Accepts `--verbose` flag and variadic `<FILES>` args.
2. **`extractor.rs`** — Parses SQL using `sqlparser` crate with `GenericDialect`. Produces `Vec<StatementRelations>` where each entry has the statement text, its name, and a list of dependency names (foreign key targets for tables, table name for indexes).
3. **`sorter.rs`** — Builds a `petgraph::DiGraph` from `StatementRelations`, runs topological sort, and detects circular dependencies.
4. **`main.rs`** — Orchestrates: parse CLI args → read files → extract → sort → print sorted statements to stdout.

## Conventions

- **Commit messages**: Conventional Commits format required. Allowed types: `feat`, `fix`, `perf`, `deps`, `revert`, `docs`, `style`, `chore`, `refactor`, `test`, `build`, `ci`. PR titles must also follow this format (lowercase subject).
- **Tests**: Unit tests are inline (`#[cfg(test)]` modules) in `extractor.rs` and `sorter.rs`.
- **Formatting**: 4-space indent for Rust, 2-space for other files. Max line length 90 (see `.editorconfig`).
- **Release**: Managed by release-please + cargo-dist. `release.yml` is auto-generated by cargo-dist — do not edit manually.
- **Dependencies**: Renovate bot handles updates. `Cargo.lock` is committed.
